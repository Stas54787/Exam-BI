<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.5, maximum-scale=3.0"
		/>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: #ffffff;
				min-height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				padding: 20px;
			}

			.container {
				max-width: 800px;
				width: 100%;
				background: white;
				border-radius: 20px;
				box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
				padding: 40px;
				text-align: center;
			}

			.logo {
				width: 64px;
				height: 64px;
				border-radius: 12px;
				border: 2px solid #fc403a1a;
				margin-bottom: 20px;
			}

			h1 {
				color: #333;
				font-size: 2rem;
				margin-bottom: 30px;
				font-weight: 700;
			}

			.stats h3 {
				color: #333;
				margin-bottom: 20px;
				font-size: 1.5rem;
			}

			.stats-grid {
				display: flex;
				gap: 20px;
				justify-content: center;
				align-items: stretch;
				flex-wrap: wrap;
				margin-bottom: 20px;
			}

			.stat-item {
				display: flex;
				align-items: center;
				justify-content: center;
				outline: none;
				cursor: default;
				width: 150px;
				height: 80px;
				background-image: linear-gradient(
					to top,
					#d8d9db 0%,
					#fff 80%,
					#fdfdfd 100%
				);
				border-radius: 30px;
				border: 1px solid #8f9092;
				font-family: 'Source Sans Pro', sans-serif;
				font-size: 14px;
				font-weight: 600;
				color: #606060;
				text-shadow: 0 1px #fff;
				flex-direction: column;
				padding: 10px;
			}

			.stat-number {
				font-size: 1.5rem;
				font-weight: 800;
				color: #fc403a;
				margin-bottom: 5px;
			}

			.stat-label {
				font-size: 0.9rem;
				text-align: center;
				line-height: 1.2;
			}

			.stats-progress-bar {
				width: 100%;
				height: 14px;
				background: #eee;
				border-radius: 8px;
				margin: 18px 0 8px 0;
				overflow: hidden;
				box-shadow: 0 2px 8px rgba(252, 64, 58, 0.08);
			}

			.stats-progress-fill {
				height: 100%;
				background: linear-gradient(90deg, #fc403a 0%, #130909 100%);
				width: 0%;
				border-radius: 8px;
				transition: width 0.5s;
			}

			.exam-section {
				display: none;
			}

			.question-card {
				background: #f9f9f9;
				border-radius: 15px;
				padding: 30px;
				margin: 20px 0;
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
			}

			.question-type {
				color: #666;
				font-size: 1rem;
				margin-bottom: 15px;
			}

			.question-text {
				color: #333;
				font-size: 1.2rem;
				line-height: 1.6;
				font-weight: 500;
			}

			.evaluator-section {
				background: #f8f9fa;
				border-radius: 15px;
				padding: 25px;
				margin: 20px 0;
				border: 2px solid #e9ecef;
			}

			.evaluator-title {
				font-size: 1.3rem;
				font-weight: 700;
				color: #333;
				margin-bottom: 20px;
			}

			.evaluation-result {
				padding: 15px;
				border-radius: 10px;
				margin: 15px 0;
				font-weight: 600;
				font-size: 1.1rem;
			}

			.result-correct {
				background: #d4edda;
				color: #155724;
				border: 1px solid #c3e6cb;
			}

			.result-incorrect {
				background: #f8d7da;
				color: #721c24;
				border: 1px solid #f5c6cb;
			}

			.evaluation-buttons {
				display: flex;
				flex-direction: row !important;
				gap: 15px;
				justify-content: center;
				align-items: center;
			}

			.btn-correct {
				display: flex;
				align-items: center;
				justify-content: center;
				outline: none;
				cursor: pointer;
				width: 150px;
				height: 50px;
				background-image: linear-gradient(
					to top,
					#90ee90 0%,
					#98fb98 80%,
					#f0fff0 100%
				);
				border-radius: 30px;
				border: 1px solid #228b22;
				transition: all 0.2s ease;
				font-family: 'Source Sans Pro', sans-serif;
				font-size: 14px;
				font-weight: 600;
				color: #006400;
				text-shadow: 0 1px #fff;
			}

			.btn-correct:hover {
				box-shadow: 0 4px 3px 1px #f0fff0, 0 6px 8px #90ee90, 0 -4px 4px #228b22,
					0 -6px 4px #f0fff0, inset 0 0 3px 3px #90ee90;
			}

			.btn-floating {
				display: flex;
				align-items: center;
				justify-content: center;
				outline: none;
				cursor: pointer;
				width: 150px;
				height: 50px;
				background-image: linear-gradient(
					to top,
					#87ceeb 0%,
					#b0e0e6 80%,
					#f0ffff 100%
				);
				border-radius: 30px;
				border: 1px solid #4682b4;
				transition: all 0.2s ease;
				font-family: 'Source Sans Pro', sans-serif;
				font-size: 14px;
				font-weight: 600;
				color: #0077be;
				text-shadow: 0 1px #fff;
			}

			.btn-floating:hover {
				box-shadow: 0 4px 3px 1px #f0ffff, 0 6px 8px #87ceeb, 0 -4px 4px #4682b4,
					0 -6px 4px #f0ffff, inset 0 0 3px 3px #b0e0e6;
			}

			.btn-floating:active {
				box-shadow: 0 4px 3px 1px #f0ffff, 0 6px 8px #87ceeb, 0 -4px 4px #4682b4,
					0 -6px 4px #f0ffff, inset 0 0 5px 3px #4682b4, inset 0 0 30px #87ceeb;
			}

			.btn-floating:focus {
				box-shadow: 0 4px 3px 1px #f0ffff, 0 6px 8px #87ceeb, 0 -4px 4px #4682b4,
					0 -6px 4px #f0ffff, inset 0 0 5px 3px #4682b4, inset 0 0 30px #87ceeb;
			}

			.btn-incorrect {
				display: flex;
				align-items: center;
				justify-content: center;
				outline: none;
				cursor: pointer;
				width: 150px;
				height: 50px;
				background-image: linear-gradient(
					to top,
					#ffb6c1 0%,
					#ffc0cb 80%,
					#fff0f5 100%
				);
				border-radius: 30px;
				border: 1px solid #dc143c;
				transition: all 0.2s ease;
				font-family: 'Source Sans Pro', sans-serif;
				font-size: 14px;
				font-weight: 600;
				color: #8b0000;
				text-shadow: 0 1px #fff;
			}

			.btn-incorrect:hover {
				box-shadow: 0 4px 3px 1px #fff0f5, 0 6px 8px #ffb6c1, 0 -4px 4px #dc143c,
					0 -6px 4px #fff0f5, inset 0 0 3px 3px #ffb6c1;
			}

			.btn {
				padding: 15px 30px;
				border: none;
				border-radius: 10px;
				font-size: 1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s;
				min-width: 120px;
			}

			.btn-success {
				background: #28a745;
				color: white;
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
			}

			.btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
				box-shadow: none;
			}

			.button-group {
				margin-top: 30px;
				display: flex;
				gap: 15px;
				justify-content: center;
			}

			.celebration {
				background: #ffffff;
				color: #333;
				border: 2px solid #fc403a;
			}

			.celebration h2 {
				color: #fc403a;
			}

			.score-display {
				padding: 20px;
				border-radius: 15px;
				margin: 20px 0;
				color: white;
			}

			.score-numbers {
				font-size: 1.5rem;
				font-weight: 700;
				margin-top: 10px;
			}

			.stat-item-button {
				display: flex;
				align-items: center;
				justify-content: center;
				outline: none;
				cursor: pointer;
				width: 150px;
				height: 50px;
				background-image: linear-gradient(
					to top,
					#d8d9db 0%,
					#fff 80%,
					#fdfdfd 100%
				);
				border-radius: 30px;
				border: 1px solid #8f9092;
				transition: all 0.2s ease;
				font-family: 'Source Sans Pro', sans-serif;
				font-size: 14px;
				font-weight: 600;
				color: #606060;
				text-shadow: 0 1px #fff;
			}

			.stat-item-button:hover {
				box-shadow: 0 4px 3px 1px #fcfcfc, 0 6px 8px #d6d7d9, 0 -4px 4px #cecfd1,
					0 -6px 4px #fefefe, inset 0 0 3px 3px #cecfd1;
			}

			@media (max-width: 600px) {
				.container {
					padding: 20px;
				}

				.stats-grid {
					gap: 10px;
				}

				.stat-item {
					width: 120px;
					height: 70px;
				}

				.stat-number {
					font-size: 1.2rem;
				}

				.stat-label {
					font-size: 0.8rem;
				}

				.evaluation-buttons {
					flex-direction: column;
					align-items: center;
				}

				.button-group {
					flex-direction: column;
					align-items: center;
				}

				.stat-item-button {
					width: 120px;
					height: 45px;
					font-size: 12px;
				}
			}

			.notification {
				position: fixed;
				top: 20px;
				right: 20px;
				padding: 15px 20px;
				border-radius: 8px;
				z-index: 10000;
				font-weight: 600;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
				max-width: 350px;
				word-wrap: break-word;
			}

			.notification.success {
				background: #28a745;
				color: white;
			}

			.notification.info {
				background: #007bff;
				color: white;
			}

			.notification.error {
				background: #dc3545;
				color: white;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<img
				src="https://i.postimg.cc/fb8Q8KFX/Whats-App-Image-2025-07-06-at-14-08-31.jpg"
				alt="–õ–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏"
				class="logo"
			/>
			<h1>–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å–∏—Å—Ç–µ–º–µ BI</h1>

			<div class="stats">
				<h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</h3>
				<div class="stats-grid">
					<div class="stat-item">
						<div class="stat-number" id="totalQuestions">0</div>
						<div class="stat-label">–í–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="correctAnswers">0</div>
						<div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="incorrectAnswers">0</div>
						<div class="stat-label">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="successRate">0%</div>
						<div class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
					</div>
				</div>
			</div>

			<div id="mainScreen">
				<div style="display: flex; justify-content: center; margin-top: 20px">
					<button class="stat-item-button" onclick="startExam()">
						–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
					</button>
				</div>
				<address
					style="
						text-align: center;
						font-size: 0.875rem;
						color: #666;
						opacity: 0.8;
						margin-top: 30px;
					"
				>
					¬© 2025 –°–∏–∑—å–∫–æ –°—Ç–∞–Ω–∏—Å–ª–∞–≤
				</address>
			</div>

			<div id="examScreen" class="exam-section">
				<div id="questionContainer"></div>

				<div
					class="evaluator-section"
					id="evaluatorSection"
					style="display: none"
				>
					<div class="evaluator-title">üìã –û—Ü–µ–Ω–∫–∞ —ç–∫–∑–∞–º–µ–Ω–∞—Ç–æ—Ä–∞</div>
					<div class="evaluation-result" id="evaluationResult"></div>
					<div class="evaluation-buttons">
						<button class="btn-correct" onclick="evaluateAnswer(true)">
							‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
						</button>
						<button class="btn-floating" onclick="evaluateAnswer('–ü–ª–∞–≤–∞–µ—Ç')">
							üåä –ü–ª–∞–≤–∞–µ—Ç
						</button>
						<button class="btn-incorrect" onclick="evaluateAnswer(false)">
							‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
						</button>
					</div>
				</div>

				<div class="button-group">
					<button
						class="btn btn-success"
						id="completeBtn"
						onclick="completeTest()"
						style="display: none"
						disabled
					>
						–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
					</button>
				</div>
			</div>
		</div>

		<script>
			const questions = [
				{
					type: '–í–æ–ø—Ä–æ—Å',
					text: '–î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ BI? –û–±—ä—è—Å–Ω–∏—Ç–µ.',
				},
				{
					type: '–í–æ–ø—Ä–æ—Å',
					text: '–° —á–µ–º –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º—É BI? –ù–∞ —á—Ç–æ –ø–æ—Ö–æ–∂ –µ–µ –ø—Ä–∏–Ω—Ü–∏–ø?',
				},
				{
					type: '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π',
					text: '–ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ, –∫–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É BI.',
				},
				{
					type: '–í–æ–ø—Ä–æ—Å',
					text: '–ö–∞–∫–∏–µ –±—ã–≤–∞—é—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã BI?',
				},
				{
					type: '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π',
					text: '–ß—Ç–æ —Ç–∞–∫–æ–µ –¥—ç—à–±–æ—Ä–¥? –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤–∏–¥–∂–µ—Ç–æ–≤.',
				},
				{
					type: '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π',
					text: '–ß—Ç–æ —Ç–∞–∫–æ–µ —Å–≤–æ–¥–Ω—ã–µ –æ—Ç—á–µ—Ç—ã, –≥–¥–µ –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è? –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ.',
				},
				{
					type: '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π',
					text: '–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–¥–∫—É –ø–æ–¥ —Å–µ–±—è?',
				},
				{
					type: '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π',
					text: '–ß—Ç–æ —Ç–∞–∫–æ–µ —ç—Ç–∞–∂–∏ –∏–Ω—Å–∞–π—Ç? –ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤ —ç—Ç–∞–∂–∏ –∏–Ω—Å–∞–π—Ç? –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ.',
				},
			]

			const GOOGLE_SCRIPT_URL =
				'https://script.google.com/macros/s/AKfycbwEs9uFwQUvOwwqwlxSgIiCQ-NaKIvFwAxUoxjq5Kxx22FMjvLzySBnhcQCfLGud0uCBQ/exec'

			let currentQuestionIndex = 0
			let currentTestAnswered = 0
			let currentTestCorrect = 0
			let currentTestIncorrect = 0
			let testStartTime = null
			let totalAnswered = parseInt(localStorage.getItem('totalAnswered') || '0')
			let correctAnswers = parseInt(
				localStorage.getItem('correctAnswers') || '0'
			)
			let incorrectAnswers = parseInt(
				localStorage.getItem('incorrectAnswers') || '0'
			)
			let isQuestionEvaluated = false
			let answersLog = JSON.parse(localStorage.getItem('answersLog') || '[]')

			function initializeApp() {
				updateStats()
			}

			function updateStats() {
				const totalQuestionsEl = document.getElementById('totalQuestions')
				const correctAnswersEl = document.getElementById('correctAnswers')
				const incorrectAnswersEl = document.getElementById('incorrectAnswers')
				const successRateEl = document.getElementById('successRate')

				if (totalQuestionsEl) totalQuestionsEl.textContent = currentTestAnswered
				if (correctAnswersEl) correctAnswersEl.textContent = currentTestCorrect
				if (incorrectAnswersEl)
					incorrectAnswersEl.textContent = currentTestIncorrect
				if (successRateEl) {
					const progressPercent = Math.round(
						(currentTestAnswered / questions.length) * 100
					)
					successRateEl.textContent = progressPercent + '%'
				}
			}

			function startExam() {
				currentQuestionIndex = 0
				isQuestionEvaluated = false
				currentTestAnswered = 0
				currentTestCorrect = 0
				currentTestIncorrect = 0
				testStartTime = new Date()

				// –û—á–∏—â–∞–µ–º –ª–æ–≥ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
				answersLog = []
				localStorage.setItem('answersLog', JSON.stringify(answersLog))

				document.getElementById('mainScreen').style.display = 'none'
				document.getElementById('examScreen').style.display = 'block'
				showQuestion()
			}

			function showQuestion() {
				if (currentQuestionIndex >= questions.length) {
					showFinalResults()
					return
				}

				const question = questions[currentQuestionIndex]
				const questionContainer = document.getElementById('questionContainer')

				questionContainer.innerHTML = `
			<div class="question-card">
				<div class="question-type">
					${question.type} –≤–æ–ø—Ä–æ—Å ${currentTestAnswered + 1}/${questions.length}
				</div>
				<div class="question-text">${question.text}</div>
				<div class="stats-progress-bar" style="margin-top: 20px;">
					<div class="stats-progress-fill" style="width: ${Math.round(
						(currentTestAnswered / questions.length) * 100
					)}%;"></div>
				</div>
			</div>
		`

				document.getElementById('evaluatorSection').style.display = 'block'
				document.getElementById('evaluationResult').style.display = 'none'

				isQuestionEvaluated = false
				const completeBtn = document.getElementById('completeBtn')
				completeBtn.disabled = true

				if (currentQuestionIndex < questions.length - 1) {
					completeBtn.style.display = 'none'
				} else {
					completeBtn.style.display = 'inline-block'
					completeBtn.textContent = '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'
				}
			}

			function evaluateAnswer(isCorrect) {
				if (isQuestionEvaluated) return

				isQuestionEvaluated = true
				currentTestAnswered++
				totalAnswered++

				const question = questions[currentQuestionIndex]
				let resultText = ''
				let resultClass = ''
				if (isCorrect === true) {
					resultText = '‚úÖ –û—Ç–≤–µ—Ç –∑–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π'
					resultClass = 'evaluation-result result-correct'
					currentTestCorrect++
					correctAnswers++
				} else if (isCorrect === false) {
					resultText = '‚ùå –û—Ç–≤–µ—Ç –∑–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π'
					resultClass = 'evaluation-result result-incorrect'
					currentTestIncorrect++
					incorrectAnswers++
				} else if (isCorrect === '–ü–ª–∞–≤–∞–µ—Ç') {
					resultText = 'üåä –û—Ç–≤–µ—Ç –∑–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ "–ü–ª–∞–≤–∞–µ—Ç"'
					resultClass = 'evaluation-result result-floating'
					// –ù–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö, —Ç–æ–ª—å–∫–æ —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ –æ—Ç–≤–µ—á–µ–Ω–Ω—ã–π
				}

				answersLog.push({
					question: question.text,
					result:
						isCorrect === '–ü–ª–∞–≤–∞–µ—Ç'
							? '–ü–ª–∞–≤–∞–µ—Ç'
							: isCorrect
							? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ'
							: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ',
					timestamp: new Date().toISOString(),
				})

				localStorage.setItem('answersLog', JSON.stringify(answersLog))

				const resultDiv = document.getElementById('evaluationResult')
				resultDiv.textContent = resultText
				resultDiv.className = resultClass
				resultDiv.style.display = 'block'

				localStorage.setItem('totalAnswered', totalAnswered.toString())
				localStorage.setItem('correctAnswers', correctAnswers.toString())
				localStorage.setItem('incorrectAnswers', incorrectAnswers.toString())

				updateStats()

				const progressBar = document.querySelector('.stats-progress-fill')
				if (progressBar) {
					progressBar.style.width =
						Math.round((currentTestAnswered / questions.length) * 100) + '%'
				}

				setTimeout(() => {
					if (currentQuestionIndex < questions.length - 1) {
						currentQuestionIndex++
						showQuestion()
					} else {
						document.getElementById('completeBtn').disabled = false
					}
				}, 1500)
			}

			function completeTest() {
				if (!isQuestionEvaluated && currentQuestionIndex < questions.length) {
					alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –æ—Ü–µ–Ω–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç')
					return
				}
				showFinalResults()
			}

			function showFinalResults() {
				const totalQuestions = questions.length
				const percent =
					currentTestAnswered > 0
						? Math.round((currentTestCorrect / currentTestAnswered) * 100)
						: 0

				saveToGoogleSheets()

				document.getElementById('mainScreen').style.display = 'none'
				document.getElementById('examScreen').style.display = 'none'

				const container = document.querySelector('.container')
				container.innerHTML = `
			<div class="question-card celebration" style="margin-top: 40px;">
				<h2 style="color: #fc403a; margin-bottom: 20px;">üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
				<div style="font-size: 1.5rem; color: #333; font-weight: 700; margin-bottom: 30px; text-align: center;">
					–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span style="color: #fc403a;">${percent}%</span>
				</div>
				<div class="score-display" style="background: ${
					percent >= 70 ? '#28a745' : '#dc3545'
				}; margin: 20px 0;">
					<h4>–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
					<div class="score-numbers">${currentTestCorrect}/${currentTestAnswered} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
				</div>
				<div style="font-size: 1.1rem; color: #333; margin-bottom: 20px;">
					–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: <b>${currentTestAnswered} –∏–∑ ${totalQuestions}</b><br>
					–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: <b>${currentTestCorrect}</b><br>
					–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: <b>${currentTestIncorrect}</b><br>
					–ü—Ä–æ–≥—Ä–µ—Å—Å: <b>${Math.round((currentTestAnswered / totalQuestions) * 100)}%</b>
				</div>
				<div id="saveStatus" style="color: #007bff; font-weight: 600; margin: 10px 0;">
					üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Google –¢–∞–±–ª–∏—Ü—É...
				</div>
				<div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
					<button class="stat-item-button" onclick="downloadDetailedResults()">üìä –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
					<button class="stat-item-button" onclick="restartTest()">üîÑ –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
					<button class="stat-item-button" onclick="goToMainScreen()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
				</div>
			</div>
		`
			}

			function saveToGoogleSheets() {
				const testEndTime = new Date()
				const testDuration = Math.round((testEndTime - testStartTime) / 1000)

				// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞
				const currentTestAnswers = answersLog.slice(-currentTestAnswered)

				const testData = {
					testInfo: {
						startTime: testStartTime.toLocaleString('ru-RU'),
						endTime: testEndTime.toLocaleString('ru-RU'),
						duration: `${Math.floor(testDuration / 60)}:${(testDuration % 60)
							.toString()
							.padStart(2, '0')}`,
						totalQuestions: questions.length,
						answeredQuestions: currentTestAnswered,
						correctAnswers: currentTestCorrect,
						incorrectAnswers: currentTestIncorrect,
						successRate:
							currentTestAnswered > 0
								? Math.round((currentTestCorrect / currentTestAnswered) * 100)
								: 0,
						progress: Math.round(
							(currentTestAnswered / questions.length) * 100
						),
					},
					answers: currentTestAnswers.map((answer, index) => ({
						questionNumber: index + 1,
						questionType: questions[index]
							? questions[index].type
							: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
						questionText: answer.question,
						userAnswer: answer.result,
						timestamp: new Date(answer.timestamp).toLocaleString('ru-RU'),
					})),
				}

				console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', testData)
				console.log(
					'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:',
					currentTestAnswers.length
				)

				// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –û–î–ò–ù —Å–ø–æ—Å–æ–± –æ—Ç–ø—Ä–∞–≤–∫–∏
				try {
					const iframe = document.createElement('iframe')
					iframe.style.display = 'none'
					iframe.name = 'hiddenSubmit_' + Date.now()
					document.body.appendChild(iframe)

					const form = document.createElement('form')
					form.method = 'POST'
					form.action = GOOGLE_SCRIPT_URL
					form.target = iframe.name
					form.style.display = 'none'

					const dataInput = document.createElement('input')
					dataInput.type = 'hidden'
					dataInput.name = 'testData'
					dataInput.value = JSON.stringify(testData)
					form.appendChild(dataInput)

					const sourceInput = document.createElement('input')
					sourceInput.type = 'hidden'
					sourceInput.name = 'source'
					sourceInput.value = 'BI_Test_Final'
					form.appendChild(sourceInput)

					const timestampInput = document.createElement('input')
					timestampInput.type = 'hidden'
					timestampInput.name = 'timestamp'
					timestampInput.value = new Date().toISOString()
					form.appendChild(timestampInput)

					document.body.appendChild(form)

					updateSaveStatus('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Google –¢–∞–±–ª–∏—Ü—É...', 'info')

					form.submit()

					setTimeout(() => {
						if (document.body.contains(form)) {
							document.body.removeChild(form)
						}
						if (document.body.contains(iframe)) {
							document.body.removeChild(iframe)
						}
						updateSaveStatus(
							'‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É —á–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã.',
							'success'
						)
					}, 3000)
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error)
					updateSaveStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö', 'error')
				}
			}

			function updateSaveStatus(message, type) {
				const statusEl = document.getElementById('saveStatus')
				if (statusEl) {
					statusEl.textContent = message
					statusEl.className = type

					if (type === 'success') {
						statusEl.style.color = '#28a745'
					} else if (type === 'error') {
						statusEl.style.color = '#dc3545'
					} else {
						statusEl.style.color = '#007bff'
					}
				}
			}

			function downloadDetailedResults() {
				if (answersLog.length === 0) {
					alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è. –ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç —Å–Ω–∞—á–∞–ª–∞.')
					return
				}

				const csvRows = [['–ù–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞', '–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–∞', '–†–µ–∑—É–ª—å—Ç–∞—Ç']]

				answersLog.forEach((entry, index) => {
					csvRows.push([
						index + 1,
						`"${entry.question.replace(/"/g, '""')}"`,
						entry.result,
					])
				})

				const csvContent = csvRows.map(row => row.join(',')).join('\n')
				downloadCSV(csvContent, '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã_—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è_BI')
			}

			function downloadCSV(csvContent, baseFileName) {
				try {
					const BOM = '\uFEFF'
					const csvWithBOM = BOM + csvContent
					const now = new Date()
					const timestamp = `${now.getFullYear()}-${String(
						now.getMonth() + 1
					).padStart(2, '0')}-${String(now.getDate()).padStart(
						2,
						'0'
					)}_${String(now.getHours()).padStart(2, '0')}-${String(
						now.getMinutes()
					).padStart(2, '0')}`
					const fileName = `${baseFileName}_${timestamp}.csv`

					const blob = new Blob([csvWithBOM], {
						type: 'text/csv;charset=utf-8;',
					})

					const url = URL.createObjectURL(blob)
					const link = document.createElement('a')

					link.href = url
					link.download = fileName
					link.style.display = 'none'

					document.body.appendChild(link)
					link.click()

					setTimeout(() => {
						document.body.removeChild(link)
						URL.revokeObjectURL(url)
					}, 100)
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏:', error)
				}
			}

			function restartTest() {
				localStorage.removeItem('totalAnswered')
				localStorage.removeItem('correctAnswers')
				localStorage.removeItem('incorrectAnswers')
				localStorage.removeItem('answersLog')

				totalAnswered = 0
				correctAnswers = 0
				incorrectAnswers = 0
				currentQuestionIndex = 0
				isQuestionEvaluated = false
				answersLog = []

				startExam()
			}

			function goToMainScreen() {
				localStorage.removeItem('totalAnswered')
				localStorage.removeItem('correctAnswers')
				localStorage.removeItem('incorrectAnswers')
				localStorage.removeItem('answersLog')

				totalAnswered = 0
				correctAnswers = 0
				incorrectAnswers = 0
				currentQuestionIndex = 0
				isQuestionEvaluated = false
				answersLog = []

				location.reload()
			}

			document.addEventListener('DOMContentLoaded', function () {
				initializeApp()
			})
		</script>
	</body>
</html>
